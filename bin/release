#!/bin/bash

set -ex

VERSION=`./bin/version`

if [ -z $CHANNEL ]; then
  echo "CHANNEL must be defined"
  exit 1
fi

for PLATFORM in `./bin/platforms`; do
  aws s3 cp --cache-control max-age=86400 tmp/build/heroku-v$VERSION-$PLATFORM.tar.xz s3://heroku-cli-assets/branches/$CHANNEL/heroku-v$VERSION-$PLATFORM.tar.xz
  aws s3 cp --cache-control max-age=86400 tmp/build/heroku-v$VERSION-$PLATFORM.tar.xz s3://heroku-cli-assets/branches/$CHANNEL/heroku-$PLATFORM.tar.xz
  aws s3 cp --cache-control max-age=86400 tmp/build/heroku-v$VERSION-$PLATFORM.tar.gz s3://heroku-cli-assets/branches/$CHANNEL/heroku-v$VERSION-$PLATFORM.tar.gz
  aws s3 cp --cache-control max-age=86400 tmp/build/heroku-v$VERSION-$PLATFORM.tar.gz s3://heroku-cli-assets/branches/$CHANNEL/heroku-$PLATFORM.tar.gz
done
